# コンポーネント状態 リファレンス

## インタラクティブ要素の状態

クリック可能・インタラクティブな要素は全て、該当する状態を実装すること。状態の欠落は壊れているように見える。

### 要素タイプ別チェックリスト

| 要素 | デフォルト | ホバー | フォーカス | アクティブ | 無効化 | ローディング |
|-----|-----------|-------|-----------|-----------|-------|------------|
| ボタン（プライマリ） | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| ボタン（セカンダリ/ゴースト） | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| リンク | ✓ | ✓ | ✓ | ✓ | — | — |
| 入力欄/テキストエリア | ✓ | — | ✓ | — | ✓ | — |
| セレクト/ドロップダウン | ✓ | ✓ | ✓ | — | ✓ | — |
| チェックボックス/ラジオ | ✓ | ✓ | ✓ | — | ✓ | — |
| トグル/スイッチ | ✓ | ✓ | ✓ | — | ✓ | — |
| クリック可能なカード | ✓ | ✓ | ✓ | ✓ | — | — |
| クリック可能なテーブル行 | ✓ | ✓ | ✓ | — | — | — |
| アイコンボタン | ✓ | ✓ | ✓ | ✓ | ✓ | — |

### 状態ごとの視覚パターン

**ホバー**：背景の微妙な変化（`opacity: 0.9`、カラーの明度調整）、`cursor: pointer`
**フォーカス**：可視のリング — `outline: 2px solid var(--color-primary); outline-offset: 2px` — 代替なしの削除は絶対禁止
**アクティブ/押下**：短い視覚フィードバック（`transform: scale(0.98)` または微妙な色の変化）
**無効化**：`opacity: 0.4〜0.6`、`cursor: not-allowed`、`pointer-events: none`（またはフォーム要素の `disabled` 属性）、ホバー効果なし

```css
/* 無効化：正しいパターン */
button:disabled,
button[aria-disabled="true"] {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

/* フォーカス：正しいパターン */
:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  border-radius: 2px;
}
```

---

## ローディング状態

200ms 以上かかる操作にはローディングインジケーターが必要。例外なし。

### パターンの選び方

| パターン | 使用タイミング |
|---------|-------------|
| **スケルトンスクリーン** | 予測可能なレイアウトのページ/セクションの初期読み込み |
| **スピナー** | 所要時間が不明なアクション（ボタンクリック、フォーム送信） |
| **プログレスバー** | 所要時間またはステップ数がわかっている操作（ファイルアップロード、マルチステップ） |
| **オプティミスティック UI** | 成功する可能性が高い高速操作（いいね/解除、並べ替え） |
| **インラインインジケーター** | 読み込み済みページ内でのセカンダリデータ読み込み |

### スケルトンスクリーン

実際のコンテンツレイアウトに合わせてスケルトンを作成する：
- 実際のコンテンツと同じ `border-radius` を使う
- シマー（`background: linear-gradient(90deg, ...)`）またはパルスアニメーションを付ける
- 約 3 秒以上スケルトンを表示する場合はフォールバックを用意する

```css
.skeleton {
  background: linear-gradient(
    90deg,
    var(--color-skeleton-base) 25%,
    var(--color-skeleton-shine) 50%,
    var(--color-skeleton-base) 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
```

### ボタンのローディング状態

二重送信を防ぐ。処理中を示す。ボタン幅を変えない（レイアウトシフトの原因になる）。

```
[  保存する  ]  →  [ ⟳ 保存中...  ]  →  [ ✓ 保存しました  ]
```

- ローディング中はボタンを無効化する
- ボタン幅を維持する（`min-width` または固定幅）
- デフォルトに戻る前に、成功状態を短時間表示する

### タイムアウトとエラー処理

ローディング状態を永遠に続けない。必ず実装する：
- タイムアウト（操作に応じた合理的な値：10〜30 秒）
- 失敗時のエラー状態
- エラー時の再試行アクション

---

## 空状態

空状態は**ユーザーへの対話**。単なる空白は許容されない。

### 空状態の構成要素

最低限、以下を含めること：

1. **アイコンまたはイラスト** — 視覚的な拠り所、トーンを設定
2. **見出し** — この領域は何のためか（「データがありません」は不可）
3. **説明文** — なぜ空なのか？ユーザーは何ができるか？
4. **プライマリアクション** — 次に取るべき行動

```
     [アイコン]

  まだプロジェクトがありません

  最初のプロジェクトを作成して、
  タスク管理とコラボレーションを始めましょう。

  [+ 新規プロジェクト]
```

### 空状態の種類

| 種類 | メッセージのトーン | アクション |
|-----|----------------|---------|
| **初回利用** | 歓迎する、「始めましょう」 | プライマリ作成アクション |
| **フィルター/検索結果なし** | ニュートラル、「一致なし」 | フィルタークリア、検索条件の拡大 |
| **削除/クリア後** | ニュートラル | 新規作成、可能であれば元に戻す |
| **権限なし** | 説明的 | 管理者に連絡、アクセス申請 |
| **エラーによる** | 謝罪、安心させる | 再試行、サポートに連絡 |

### 避けること

- 「データがありません」— 意味がない
- 「結果が見つかりませんでした」— 次の行動を示さない
- 何もない白い空間
- ページ全体が空のときだけでなく、1 つのセクションが空のときも空状態を表示する

---

## エラー状態

エラー状態は**ユーザーが回復する**ことを助けるもの。問題を報告するだけでは不十分。

### エラーメッセージの構成

1. **何が起きたか** — 具体的に。「エラーが発生しました」は不可
2. **なぜ起きたか** — 有用で明白でない場合のみ
3. **どう修正するか** — 具体的で実行可能な内容
4. **回復アクション** — 次のステップへのボタン/リンク

```
❌  「問題が発生しました。もう一度お試しください。」

✓   「変更を保存できませんでした」
    「セッションの有効期限が切れました。続けるには再度サインインしてください。」
    [サインイン]
```

### エラーの表示場所

| エラーの種類 | 表示場所 |
|-----------|---------|
| フォームフィールドのバリデーション | フィールドの直下（インライン） |
| フォーム全体のエラー | 送信ボタンの上、またはフォームの上部 |
| ページレベルのエラー | コンテンツエリアの上部（モーダルではない） |
| アクションのエラー | トースト/通知、またはアクションの近くにインライン |
| ネットワーク/読み込みエラー | 読み込み失敗したコンテンツの位置 |

### インラインフォームエラー

```
┌─────────────────────────────┐
│ メールアドレス               │
│ ┌──────────────────────────┐│
│ │ これはメールではない       ││
│ └──────────────────────────┘│
│ ⚠ 正しいメールアドレスを    │
│   入力してください          │
└─────────────────────────────┘
```

- フィールドの下に表示（上や右側は不可）
- エラーカラー + アイコン（カラーのみは不可）
- フィールドごとに具体的なメッセージ — 汎用テキストの使い回しは不可
- ユーザーが修正を始めたらクリアする

---

## フィードバック状態

### 成功

**一時的**（トースト/通知）：3〜5 秒後に自動消去。スワイプ/手動で閉じられる。
**永続的**：完了した複数ステップのフローには確認ビューを表示。

成功メッセージは具体的な操作を確認すること：「成功しました」ではなく「プロジェクトを保存しました」。

### 通知/トーストの階層

一度に 1 つ表示。複数発生した場合はスタック（最大 3 件表示）。

| レベル | カラー | アイコン | 表示時間 |
|-------|-------|-------|--------|
| 成功 | 緑 | ✓ | 3〜4 秒 |
| 情報 | 青 | ℹ | 4〜5 秒 |
| 警告 | 琥珀 | ⚠ | 5〜6 秒 または 手動消去 |
| エラー | 赤 | ✕ | 手動消去まで常時表示 |

### オプティミスティック更新

高速で成功確率の高い操作（トグル、並べ替え、ブックマーク）の場合：
1. UI をすぐに更新する
2. API コールを実行する
3. 失敗した場合は元に戻す + エラーを表示

知覚される遅延をなくし、レスポンシブに感じさせる。

---

## 選択済み/アクティブ状態

ユーザーがアイテムを選択したとき（タブ、ナビゲーション、行、フィルターチップ）、選択状態は：

- デフォルト状態とホバー状態から**明確に区別**できる
- **カラーだけに依存しない**（背景 + テキストカラー + オプションでボーダー/インジケーター）
- 同じ種類の全要素で**一貫**している

よくあるパターン：
```css
.tab { color: var(--text-secondary); }
.tab:hover { color: var(--text-primary); }
.tab[aria-selected="true"] {
  color: var(--color-primary);
  border-bottom: 2px solid var(--color-primary);
}
```
