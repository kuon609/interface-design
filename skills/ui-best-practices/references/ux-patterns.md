# UXパターン リファレンス

## アフォーダンス

アフォーダンスとは「これはインタラクティブだ」（あるいは「そうでない」）をユーザーに伝える視覚的なシグナル。

### インタラクティブな要素はインタラクティブに見せる

| 要素 | 必要な視覚的シグナル |
|-----|-------------------|
| ボタン | 背景またはボーダー、明確な境界、ホバー状態 |
| テキスト中のリンク | カラー + アンダーライン（またはカラー + ホバー時アンダーライン） |
| クリック可能なカード | ホバー時の背景変化またはボーダー変化、`cursor: pointer` |
| ドラッグ可能 | ドラッグハンドルアイコン（`⠿` または `⋮⋮`）、ホバー時 `cursor: grab` |
| リサイズ可能 | エッジのリサイズハンドル、適切なカーソル |

### インタラクティブでない要素はインタラクティブに見せない

```
❌  リンクでない青いアンダーライン付きテキスト
❌  クリックしても何も起きないのに hover:shadow のあるボックス
❌  onClick ハンドラのない cursor:pointer を持つ要素
```

### 無効化 vs. 利用不可

**無効化**（要素は存在するが現在使用できない）：
- 視覚的にミュート（不透明度低下またはデサチュレーション）
- `cursor: not-allowed`
- 多くの場合：なぜ無効なのかを説明するツールチップ

**利用不可**（このユーザー/状態では要素が存在しない）：
- 完全に非表示にする（またはコンテキストで隠す）
- 表示する場合：別のデザインパターンを使う（錠前アイコン + アップグレード CTA）

---

## フィードバックと確認

### 応答時間の目安

| 遅延 | ユーザーの感知 | 必要な対応 |
|-----|-------------|---------|
| 100ms 未満 | 即座 | 不要 |
| 100〜300ms | 即座に感じる | オプションでインジケーター |
| 300ms〜1 秒 | 少し待つ | ローディングインジケーター |
| 1〜10 秒 | 待機中 | プログレスインジケーター |
| 10 秒超 | 長すぎる | 進捗表示 + キャンセルオプション |

**ルール**：300ms 以上かかる場合はローディング状態を表示する。例外なし。

### 破壊的操作の確認

不可逆な操作（削除、アーカイブ、取り消し）の場合：

1. **プライマリの確認**：「このプロジェクトを削除しますか？」と結果の説明
2. **高度に破壊的な場合**：リソース名の入力を要求して確認
3. **可逆性を優先する**：取り消せる「アーカイブ」 > 確認が必要な「削除」

```
┌─────────────────────────────────────┐
│ 「プロジェクト Alpha」を削除しますか？  │
│                                     │
│ プロジェクトとそのすべてのデータが    │
│ 永久に削除されます。この操作は        │
│ 取り消せません。                     │
│                                     │
│         [キャンセル] [プロジェクトを削除]│
└─────────────────────────────────────┘
```

- **キャンセル**は左側（モバイルは上）
- **破壊的アクション**は右側、`destructive` カラーで表示
- デフォルトフォーカスはキャンセルボタン
- Enter キーで開いたダイアログは破壊的アクションを確認しない

### 取り消し vs. 確認

元に戻せる操作には**取り消し**を、確認ダイアログより優先する：
- 下書きの削除 → ソフトデリート + 「元に戻す」トースト（10 秒）
- チームメンバーの削除 → 保留状態 + キャンセル可能
- レコードのアーカイブ → アーカイブビュー + 復元オプション

確認ダイアログは本当に不可逆な操作のためにとっておく。

---

## フォーム

### ラベルの配置

入力欄の上に**可視ラベル**を置くこと（プレースホルダーをラベル代わりに使わない）。

```
✓  メールアドレス           ❌  [john@example.com]
   [john@example.com]          ← タイプすると消える
```

フローティングラベルは正しく実装すれば許容範囲内（常に表示され、フォーカス時だけでない）。

### バリデーションのタイミング

| いつ行うか | ルール |
|----------|-------|
| **フォーカスを外したとき（blur）** | 初回 — ユーザーがフィールドを離れたとき |
| **変更時（最初の blur 後）** | リアルタイムフィードバックのためにタイプに応じて更新 |
| **送信時** | 最終チェック、最初のエラーにスクロール |
| **タイプ中（最初の blur 前）は行わない** | 鬱陶しく、時期尚早 |

### フォームのエラー回復

- 送信時は最初のエラーにスクロール
- 最初のエラーフィールドにフォーカスを移す
- ユーザーが入力した値をすべて保持する（フォームをクリアしない）
- ユーザーが修正を始めたらフィールドのエラーをクリアする（change 時）

### フィールドレイアウト

- 多くのフォームは**シングルカラム**（スキャンしやすい）
- **隣接する 2 カラム**は次の場合のみ：姓名、都道府県/市区町村/郵便番号
- **論理的な順序**：ユーザーのメンタルモデルに合わせる（データベースのスキーマではない）
- 関連するフィールドは視覚的な近さでグループ化する

### マルチステップフォーム

- ステップインジケーターを表示（ステップ 2/4）
- 各ステップで進捗を保存（戻ってもデータが失われない）
- 最終ステップ：送信前のサマリー
- 成功状態：明確な完了確認

---

## ナビゲーション

### 現在地の把握

ユーザーが常に自分の位置を知れるようにする：

- 現在のナビゲーションアイテムにアクティブ状態（ホバー状態だけでなく）
- 深い階層（3 段以上）にはパンくずリスト
- ページタイトルはナビゲーションアイテムのラベルと完全に一致する

### 戻るナビゲーション

- 常に戻る/上に行く方法を提供する
- ブラウザの「戻る」ボタンが機能するようにする（壊さない）
- 行き止まりを作らない（閉じられないモーダル、ナビゲーションのないページ）

### 一貫性

- ナビゲーションの配置は全ページで統一
- 同じアクションは常に同じ位置
- ページ間でナビゲーションアイテムを移動したりラベルを変えない

---

## モーダル・ダイアログ

### モーダルを使うべき場面

以下の場合にモーダルを使う：
- 続ける前に注意が必要な集中タスク（確認、コンテキスト内編集）
- フルページを必要としない簡単なフォーム
- 確認が必要なアラート

以下には**使わない**：
- 複雑なフォーム（5 フィールド超 → ページを使う）
- 連続するステップ（2 ステップ超 → ページを使う）
- インラインやツールチップで表示できる情報
- 非破壊的な操作の確認

### モーダルの要件

全てのモーダルは必ず：

1. **Escape キーで閉じる**
2. **背景クリックで閉じる**（未保存の変更がある場合は警告してから）
3. **フォーカストラップ**：開いている間はモーダル内でタブが循環する
4. **フォーカスを返す**：閉じたときにトリガー要素にフォーカスを戻す
5. **開いたとき最初のインタラクティブ要素にフォーカス**（または見出しに）
6. **可視の閉じるボタン**（×）がある — Escape が効いても

### ネストしたモーダルは禁止

モーダルの中からモーダルを開かない。代わりにタブ、ステップ、またはインライン展開を使う。

### ドロワー/サイドパネル

コンテキストが有益なタスク（リストを見ながらアイテムを編集する）に：
- モーダルの代わりにサイドパネル/ドロワーを使う
- やはり Escape で閉じることを要求する
- フォーカストラップを適用する

---

## プログレッシブディスクロージャー

必要なものだけを表示する。複雑さはオンデマンドで展開する。

### パターン

| パターン | 用途 |
|---------|------|
| **折り畳みセクション** | オプションの詳細、詳細設定 |
| **タブ** | 並列カテゴリ（連続ステップではない） |
| **アコーディオン** | FAQ、設定グループ |
| **ツールチップ/ポップオーバー** | コンテキストを離れずに補足情報 |
| **「もっと見る」** | 長いリストやテキストの短縮表示 |
| **「詳細設定」** | パワーユーザー向け設定 |

### テキストの切り詰め

テキストを切り詰めるときは：
- 常に全文を見る方法を提供する
- 「続きを読む」リンク、展開可能な行、詳細ビュー
- 短いラベル（ファイル名、ユーザー名）にはホバー時のツールチップ
- 比較が必要なデータ（数値、日付）は切り詰めない — カラムを広げる

---

## データテーブル

### 必須の動作

- **ソート可能なカラム**：ヘッダークリックでソート、方向を表示（▲▼）
- **ページネーション**またはインフィニットスクロール — 全行を単純に表示しない
- **空状態**：空のテーブルではない — [states.md](states.md) を参照
- **ローディング状態**：スケルトン行またはスピナーオーバーレイ

### カラム設計

- 数値カラムは右揃え（比較しやすい）
- テキストカラムは左揃え
- ステータス・日付・アクションカラムは固定幅
- 名前/説明カラムは可変幅

### 行のアクション

- ホバー時にアクションを表示（常時表示しない — 視覚的ノイズを減らす）
- 表示するのは 2〜3 アクションまで。それ以上は「...」メニュー
- 破壊的な行のアクション：実行前に確認

### 選択

- 1 列目にチェックボックス
- ヘッダーで全選択
- 行が選択されると一括操作が表示（テーブルの上または下）
- 選択件数を明示：「3 件選択中」

---

## タッチ・モバイルへの配慮

Web アプリでもタッチを考慮する：

- **タッチターゲット**：最小 44×44px（Apple HIG）/ 48×48px（Material Design）
- **ホバー専用のインタラクション禁止**：ホバー時のみ表示されるコンテンツはタッチで利用不可
- **スワイプ操作**：実装する場合（スワイプ削除など）は代替手段も提供する（長押し、ボタン）
- **ダブルタップは不要**：プライマリアクションにダブルタップを要求しない
- **ボトムヘビーレイアウト**：モバイルではプライマリアクションを画面下部（親指の届く範囲）に配置
